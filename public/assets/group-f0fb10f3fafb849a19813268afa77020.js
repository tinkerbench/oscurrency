function update_topic(){topic_id=$("#topic").attr("data-id"),after=$(".forum_post:first-child").attr("data-time"),$.ajaxSetup({cache:!0}),$.getScript("/posts?topic_id="+topic_id+"&after="+after),$.ajaxSetup({cache:!1})}var OSCURRENCY={};[].indexOf||(Array.prototype.indexOf=function(e,t){t=t==null?0:t;var n=this.length;for(var r=t;r<n;r++)if(this[r]==e)return r;return-1}),$(function(){function e(){return path=window.location.pathname,a=path.split("/"),a[2]}function t(e,t,n){r={tab:OSCURRENCY.tab_prefix+e,path:t,url:n},OSCURRENCY.routes.push(r)}function n(e){var t=[],n="",s="";for(i=0;i<OSCURRENCY.routes.length;i++){r=OSCURRENCY.routes[i];if(t=e.match(r.path)){s=r.tab,n=r.url.replace(/\[:group_id\]/,OSCURRENCY.group_id);for(j=1;j<t.length;j++)n=n.replace("[:"+j+"]",t[j]);return[s,n]}}return["",""]}function s(e){var t=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/;return t.exec(e)}function o(e){names=["url","scheme","slash","host","port","path","query","hash"],result=s(e),path=result[names.indexOf("path")],query=result[names.indexOf("query")],hash="#",a=path.split("/");for(i=0;i<parseInt(a.length/2);i++)i>0&&hash.length>1&&(hash+="/"),a[i*2]!="groups"&&(hash+=a[i*2]+"/"+a[i*2+1]);parseInt(a.length/2)!=a.length/2&&(hash.length>1&&(hash+="/"),hash+=a[a.length-1]);if(query!=undefined&&query.length>0){var t=query.split("&");for(i=0;i<t.length;i++)t[i].split("=")[0]!="group"&&(hash+="/"+t[i])}return hash}function u(e,t){var n="";return"all"==e&&-1==t.indexOf("edit")&&-1==t.indexOf("new")&&(n=-1==t.indexOf("?")?"?scope=all":"&scope=all"),n}function f(e){e!=OSCURRENCY.offers_mode&&(OSCURRENCY.offers_mode=e,"#offers"==window.location.hash?window.location.hash="#offers/page=1":window.location.hash="#offers")}function l(e){e!=OSCURRENCY.reqs_mode&&(OSCURRENCY.reqs_mode=e,"#requests"==window.location.hash?window.location.hash="#reqs/page=1":window.location.hash="#requests")}OSCURRENCY.group_id=e(),OSCURRENCY.routes=[],OSCURRENCY.tab_prefix="#tab_",OSCURRENCY.tab="",OSCURRENCY.post_allowed=!0,OSCURRENCY.notice_fadeout_time=8e3,OSCURRENCY.delete_fadeout_time=4e3,OSCURRENCY.offers_mode="",OSCURRENCY.reqs_mode="",$("#tabs").tabs({select:function(e,t){OSCURRENCY.tab=t.tab.hash},fx:{}}),$("ul.ui-tabs-nav").show(),t("home",/^#home$/,"/groups/[:group_id]"),t("home",/^#member_preferences\/(\d+)\/edit$/,"/member_preferences/[:1]/edit"),t("home",/^#graphs$/,"/groups/[:group_id]/graphs"),t("exchanges",/^#exchanges\/page=(\d+)/,"/groups/[:group_id]/exchanges?page=[:1]"),t("requests",/^#reqs\/page=(\d+)/,"/groups/[:group_id]/reqs?page=[:1]"),t("offers",/^#offers\/page=(\d+)/,"/groups/[:group_id]/offers?page=[:1]"),t("people",/^#people\/page=(\d+)/,"/groups/[:group_id]/memberships?page=[:1]"),t("forum",/^#forum\/page=(\d+)/,"/groups/[:group_id]/forum?page=[:1]"),t("requests",/^#reqs\/(\d+)$/,"/reqs/[:1]"),t("requests",/^#reqs\/(\d+)\/edit$/,"/reqs/[:1]/edit"),t("requests",/^#reqs\/new$/,"/groups/[:group_id]/reqs/new"),t("offers",/^#offers\/(\d+)$/,"/offers/[:1]"),t("offers",/^#offers\/(\d+)\/edit$/,"/offers/[:1]/edit"),t("offers",/^#offers\/new$/,"/groups/[:group_id]/offers/new"),t("people",/^#people\/(.+)\/exchanges\/new$/,"/people/[:1]/exchanges/new?group="+OSCURRENCY.group_id),t("offers",/^#people\/(.+)\/exchanges\/new\/offer=(\d+)$/,"/people/[:1]/exchanges/new?offer=[:2]"),t("people",/^#people\/(.+)\/messages\/new$/,"/people/[:1]/messages/new"),t("people",/^#people\/(.+)\/accounts\/(\d+)/,"/people/[:1]/accounts/[:2]"),t("people",/^#memberships\/(\d+)$/,"/memberships/[:1]"),t("forum",/^#forums\/(\d+)\/topics\/(\d+)$/,"/forums/[:1]/topics/[:2]"),t("forum",/^#forums\/(\d+)\/topics\/(\d+)\/page=(\d+)$/,"/forums/[:1]/topics/[:2]?page=[:3]"),t("exchanges",/^#exchanges$/,"/groups/[:group_id]/exchanges"),t("forum",/^#forum$/,"/groups/[:group_id]/forum"),t("requests",/^#requests$/,"/groups/[:group_id]/reqs"),t("requests",/^#requests\/category_id=$/,"/groups/[:group_id]/reqs"),t("requests",/^#requests\/category_id=(\d+)$/,"/groups/[:group_id]/reqs?category_id=[:1]"),t("requests",/^#reqs\/category_id=(\d+)\/page=(\d+)$/,"/groups/[:group_id]/reqs?category_id=[:1]&page=[:2]"),t("requests",/^#requests\/neighborhood_id=$/,"/groups/[:group_id]/reqs"),t("requests",/^#requests\/neighborhood_id=(\d+)$/,"/groups/[:group_id]/reqs?neighborhood_id=[:1]"),t("requests",/^#reqs\/neighborhood_id=(\d+)\/page=(\d+)$/,"/groups/[:group_id]/reqs?neighborhood_id=[:1]&page=[:2]"),t("offers",/^#offers$/,"/groups/[:group_id]/offers"),t("offers",/^#offers\/category_id=$/,"/groups/[:group_id]/offers"),t("offers",/^#offers\/category_id=(\d+)$/,"/groups/[:group_id]/offers?category_id=[:1]"),t("offers",/^#offers\/category_id=(\d+)\/page=(\d+)$/,"/groups/[:group_id]/offers?category_id=[:1]&page=[:2]"),t("offers",/^#offers\/neighborhood_id=$/,"/groups/[:group_id]/offers"),t("offers",/^#offers\/neighborhood_id=(\d+)$/,"/groups/[:group_id]/offers?neighborhood_id=[:1]"),t("offers",/^#offers\/neighborhood_id=(\d+)\/page=(\d+)$/,"/groups/[:group_id]/offers?neighborhood_id=[:1]&page=[:2]"),t("people",/^#people$/,"/groups/[:group_id]/memberships"),t("people",/^#people\/category_id=$/,"/groups/[:group_id]/memberships"),t("people",/^#people\/category_id=(\d+)$/,"/groups/[:group_id]/memberships?category_id=[:1]"),t("people",/^#people\/category_id=(\d+)\/page=(\d+)$/,"/groups/[:group_id]/memberships?category_id=[:1]&page=[:2]"),t("people",/^#people\/neighborhood_id=$/,"/groups/[:group_id]/memberships"),t("people",/^#people\/neighborhood_id=(\d+)$/,"/groups/[:group_id]/memberships?neighborhood_id=[:1]"),t("people",/^#people\/neighborhood_id=(\d+)\/page=(\d+)$/,"/groups/[:group_id]/memberships?neighborhood_id=[:1]&page=[:2]"),$(window).hashchange(function(){var e=location.hash,t="",r="",i=[];if(e.length!=0){var s=$("#tabs");i=n(e),r=i[0],t=i[1],"#tab_offers"==r?t+=u(OSCURRENCY.offers_mode,t):"#tab_requests"==r&&(t+=u(OSCURRENCY.reqs_mode,t)),r!=OSCURRENCY.tab&&s.tabs("select",r),t.length!=0&&($.ajaxSetup({cache:!0}),$.getScript(t),$.ajaxSetup({cache:!1}))}}),$(document).bind("ajaxStart",function(){$("span.wait").show()}),$(document).bind("ajaxStop",function(){$("span.wait").hide(),OSCURRENCY.post_allowed=!0}),$("input#bid_expiration_date").live("focus",function(){$(this).datepicker({buttonImage:"/images/calendar.gif",buttonImageOnly:!0,dateFormat:"yy-mm-dd"})}),$("input#req_due_date").live("focus",function(){$(this).datepicker({buttonImage:"/images/calendar.gif",buttonImageOnly:!0,dateFormat:"yy-mm-dd"})}),$("input#offer_expiration_date").live("focus",function(){$(this).datepicker({buttonImage:"/images/calendar.gif",buttonImageOnly:!0,dateFormat:"yy-mm-dd"})}),$(".edit_member_preference, #new_bid, .edit_bid, #new_req, #edit_req, #new_offer, #edit_offer, #new_topic, #new_post, #new_exchange, #new_wall_post, #new_message").live("submit",function(){return OSCURRENCY.post_allowed?(OSCURRENCY.post_allowed=!1,$.post($(this).attr("action"),$(this).serialize(),null,"script")):alert("request is being processed..."),!1}),$(".search_form").live("submit",function(){return $.get($(this).attr("action"),$(this).serialize(),null,"script"),!1}),$(".add_to_memberships").live("click",function(){if(confirm("Are you sure?")){id_name=$(this).children("a").attr("id"),$(this).hide();var e=id_name=="leave_group"?{_method:"delete"}:{};$.post($(this).children("a").attr("href"),e,null,"script")}return!1}),$(".delete_topic, .delete_post, .delete_req, .delete_offer").live("click",function(){if(confirm("Delete?")){var e={_method:"delete"};$.post($(this).attr("href"),e,null,"script")}return!1}),$(".deactivate_req").live("click",function(){var e={_method:"deactivate"};return $.post($(this).attr("href"),e,null,"script"),!1}),$("a.pay_now").live("click",function(){return window.location.hash=o(this.href),!1}),$(".pagination a").live("click",function(){return str=o(this.href),str=str.replace(/memberships/,"people"),window.location.hash=str,!1}),$("a[href="+OSCURRENCY.tab_prefix+"home]").bind("click",function(){window.location.hash="#home"}),$("a[href="+OSCURRENCY.tab_prefix+"forum]").bind("click",function(){$("#forum_form").html(""),window.location.hash="#forum"}),$("a[href="+OSCURRENCY.tab_prefix+"requests]").bind("click",function(){window.location.hash="#requests"}),$("a[href="+OSCURRENCY.tab_prefix+"offers]").bind("click",function(){window.location.hash="#offers"}),$("a[href="+OSCURRENCY.tab_prefix+"exchanges]").bind("click",function(){window.location.hash="#exchanges"}),$("a[href="+OSCURRENCY.tab_prefix+"people]").bind("click",function(){window.location.hash="#people"}),$(".category_filter #req_category_ids").live("change",function(){window.location.hash="#requests/category_id="+this.value}),$(".category_filter #offer_category_ids").live("change",function(){window.location.hash="#offers/category_id="+this.value}),$(".category_filter #person_category_ids").live("change",function(){window.location.hash="#people/category_id="+this.value}),$(".neighborhood_filter #req_neighborhood_ids").live("change",function(){window.location.hash="#requests/neighborhood_id="+this.value}),$(".neighborhood_filter #offer_neighborhood_ids").live("change",function(){window.location.hash="#offers/neighborhood_id="+this.value}),$(".neighborhood_filter #person_neighborhood_ids").live("change",function(){window.location.hash="#people/neighborhood_id="+this.value}),$("a.show-follow").live("click",function(){return window.location.hash=o(this.href),!1}),$("a.email-link").live("click",function(){return window.location.hash=o(this.href),!1}),$.fn.make_filter_visible=function(){$(this).parent().children().removeClass("filter_selected"),$(this).addClass("filter_selected")},$(".toggle-category").live("click",function(){return $(this).make_filter_visible(),$("span.category_filter").show(),$("span.neighborhood_filter").hide(),!1}),$(".toggle-neighborhood").live("click",function(){return $(this).make_filter_visible(),$("span.category_filter").hide(),$("span.neighborhood_filter").show(),!1}),$(".toggle-active-offers").live("click",function(){return $(this).make_filter_visible(),f(""),!1}),$(".toggle-all-offers").live("click",function(){return $(this).make_filter_visible(),f("all"),!1}),$(".toggle-active-reqs").live("click",function(){return $(this).make_filter_visible(),l(""),!1}),$(".toggle-all-reqs").live("click",function(){return $(this).make_filter_visible(),l("all"),!1}),$(window).trigger("hashchange")});